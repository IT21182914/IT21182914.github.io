<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <pre>

<code>



<!-- *********Create a data class for the User entity**********
import androidx.room.Entity
import androidx.room.PrimaryKey

@Entity(tableName = "users")
data class User(
    @PrimaryKey(autoGenerate = true)
    val id: Int = 0,
    val firstName: String,
    val lastName: String,
    val email: String,
    val contactNumber: String,
    val password: String
)

*********Data Class Done**********



******Create a UserDao interface for database operations******

import androidx.room.*

@Dao
interface UserDao {
    @Insert
    fun insert(user: User)

    @Update
    fun update(user: User)

    @Delete
    fun delete(user: User)

    @Query("SELECT * FROM users")
    fun getAllUsers(): List<User>
}


*******UserDao interface********



******Create a RoomDatabase class*******
import androidx.room.Database
import androidx.room.RoomDatabase

@Database(entities = [User::class], version = 1)
abstract class AppDatabase : RoomDatabase() {
    abstract fun userDao(): UserDao
}

******RoomDatabase class DONE*******

*****Initialize the Room database in your application class****

import android.app.Application
import androidx.room.Room

class MyApp : Application() {
    companion object {
        lateinit var database: AppDatabase
    }

    override fun onCreate() {
        super.onCreate()
        database = Room.databaseBuilder(
            applicationContext,
            AppDatabase::class.java,
            "my_database"
        ).build()
    }
}

****Room database application class DONE************


*****Sign Up Activity******

import android.os.Bundle
import android.widget.Button
import android.widget.EditText
import androidx.appcompat.app.AppCompatActivity
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.GlobalScope
import kotlinx.coroutines.launch

class SignUpActivity : AppCompatActivity() {
    private lateinit var firstNameEditText: EditText
    private lateinit var lastNameEditText: EditText
    private lateinit var emailEditText: EditText
    private lateinit var contactNumberEditText: EditText
    private lateinit var passwordEditText: EditText
    private lateinit var confirmPasswordEditText: EditText
    private lateinit var signUpButton: Button

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_sign_up)

        firstNameEditText = findViewById(R.id.editTextFirstName)
        lastNameEditText = findViewById(R.id.editTextLastName)
        emailEditText = findViewById(R.id.editTextEmail)
        contactNumberEditText = findViewById(R.id.editTextContactNumber)
        passwordEditText = findViewById(R.id.editTextPassword)
        confirmPasswordEditText = findViewById(R.id.editTextConfirmPassword)
        signUpButton = findViewById(R.id.buttonSignUp)

        signUpButton.setOnClickListener {
            val firstName = firstNameEditText.text.toString()
            val lastName = lastNameEditText.text.toString()
            val email = emailEditText.text.toString()
            val contactNumber = contactNumberEditText.text.toString()
            val password = passwordEditText.text.toString()
            val confirmPassword = confirmPasswordEditText.text.toString()

            if (validateInput(firstName, lastName, email, contactNumber, password, confirmPassword)) {
                val user = User(firstName = firstName, lastName = lastName, email = email, contactNumber = contactNumber, password = password)

                GlobalScope.launch(Dispatchers.IO) {
                    MyApp.database.userDao().insert(user)
                }

                // Navigate to the Customer profile page
                // (implement your navigation logic here)
            }
        }
    }

    private fun validateInput(firstName: String, lastName: String, email: String, contactNumber: String, password: String, confirmPassword: String): Boolean {
        // Perform your validation logic here
        if (contactNumber.length < 10) {
            contactNumberEditText.error = "Contact number should be more than 10 digits."
            return false
        }

        if (password != confirmPassword) {
            confirmPasswordEditText.error = "Passwords do not match."
            return false
        }

        // Add more validation rules if needed

        return true
    }
}
***********Sign Up DONE**************

****Sign Up Test***
class SignUpActivityUnitTest {

    @Test
    fun validateInput_validData_returnsTrue() {
        val firstName = "John"
        val lastName = "Doe"
        val email = "john.doe@example.com"
        val contactNumber = "1234567890"
        val password = "password"
        val confirmPassword = "password"

        val signUpActivity = SignUpActivity()

        val isValid = signUpActivity.validateInput(
            firstName,
            lastName,
            email,
            contactNumber,
            password,
            confirmPassword
        )

        assertTrue(isValid)
    }

    }


*******Sign Up Test DONE********







********T CODE**********

*****MainActivity********



class MainActivity : AppCompatActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        val repository = TodoRepository(TodoDatabase.getInstance(this))
        val recyclerView: RecyclerView = findViewById(R.id.rvTodoList)
        val ui = this  //this refers to the current activity
        val adapter = TodoAdapter()

        recyclerView.adapter = adapter
        recyclerView.layoutManager = LinearLayoutManager(ui)

        val btnAddTodo = findViewById<Button>(R.id.btnAddTodo)
        btnAddTodo.setOnClickListener {

            displayDialog(repository, adapter)
        }


        CoroutineScope(Dispatchers.IO).launch {//handling databases or i/o operations
            val data = repository.getAllTodos()
            adapter.setData(data, ui)
        }

    }

    fun displayDialog(repository: TodoRepository, adapter: TodoAdapter) {
// Create a new instance of AlertDialog.Builder
        val builder = AlertDialog.Builder(this)
// Set the alert dialog title and message
        builder.setTitle("Enter New Todo item:")
        builder.setMessage("Enter the todo item below:")
// Create an EditText input field
        val input = EditText(this)
        input.inputType = InputType.TYPE_CLASS_TEXT
        builder.setView(input)
// Set the positive button action
        builder.setPositiveButton("OK") { dialog, which ->
// Get the input text and display a Toast message
            val item = input.text.toString()
            CoroutineScope(Dispatchers.IO).launch {
                repository.insert(Todo(item))
                repository.update(Todo(item))
                val data = repository.getAllTodos()
                runOnUiThread{
                    adapter.setData(data,this@MainActivity)
                }
            }
        }
// Set the negative button action
        builder.setNegativeButton("Cancel") { dialog, which ->
            dialog.cancel()
        }
// Create and show the alert dialog
        val alertDialog = builder.create()
        alertDialog.show()
    }

}

*****MainActivity DONE********


*******TodoAdapter*******


class TodoAdapter: RecyclerView.Adapter<TodoAdapter.ViewHolder>() {

    lateinit var data: List<Todo>
    lateinit var context: Context

    class ViewHolder (view: View):RecyclerView.ViewHolder(view){

      val cbTodo:CheckBox
      val ivDelete:ImageView

      init {
          cbTodo = view.findViewById(R.id.cbTodo)
          ivDelete = view.findViewById(R.id.ivDelete)

      }

    }
    fun setData(data: List<Todo>, context: Context) {
        this.data = data
        this.context = context
        notifyDataSetChanged()
    }

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ViewHolder{
        val view = LayoutInflater.from(parent.context).inflate(R.layout.view_item,parent,false)

        return ViewHolder(view)

    }


    override fun onBindViewHolder(holder: ViewHolder, position: Int) {
        holder.cbTodo.text = data[position].item
        holder.ivDelete.setOnClickListener {
            if(holder.cbTodo.isChecked){
                val repository = TodoRepository(TodoDatabase.getInstance(context))
            holder.ivDelete.setImageResource(R.drawable.delete_icon_selected)
                CoroutineScope(Dispatchers.IO).launch {
                    repository.delete(data[position])
                    val data = repository.getAllTodos()
                    withContext(Dispatchers.Main) {
                        setData(data, context)
                        holder.ivDelete.setImageResource(R.drawable.delete_icon)
                    }
                }
            }else{
                Toast.makeText(context,"Cannot delete unmarked Todo items",Toast.LENGTH_LONG)
                    .show()
            }
        }
    }

    override fun getItemCount() = data.size
}



******TodoAdapter DONE **********


*******TodoDatabase*******

@Database(entities = [Todo::class], version = 1)
    abstract class TodoDatabase: RoomDatabase(){
        abstract fun getTodoDao(): TodoDoa  //get all CRUD
        companion object{
            @Volatile  //our memory use to save instance
            private var INSTANCE: TodoDatabase? = null    //initially null
            fun getInstance(context: Context):TodoDatabase{
                synchronized(this){  //syncronized means only one thread can access this block at a time.no parallel access
                    return INSTANCE ?: Room.databaseBuilder(
                        context.applicationContext,
                        TodoDatabase::class.java,
                        "todo_db" // database name we give
                    ).build().also {
                        INSTANCE = it
                    }
                }
            }
        }
    }



******TodoDatabase DONE********


******TodoRepository******

class TodoRepository(

    private val db: TodoDatabase

) {

    suspend fun insert(todo: Todo) = db.getTodoDao().insertTodo(todo)
    suspend fun delete(todo: Todo) = db.getTodoDao().delete(todo)
    suspend fun update(todo: Todo) = db.getTodoDao().update(todo)
    fun getAllTodos() =db.getTodoDao().getAllTodos()


}


******TodoRepository DONE*******


*****Todo*****



@Entity    //creating Raw to the table
data class Todo(

    var item:String?

){

    @PrimaryKey(autoGenerate = true)   //auto increment the id value in the table
    var id:Int? = null  //primary key
}


*****Todo DONE *****


****TodoDAO*****





@Dao
interface TodoDoa {

    @Insert
    suspend fun insertTodo(todo: Todo)

    @Delete
    suspend fun delete(todo: Todo)

    @Update
    suspend fun update(todo: Todo)

    @Query("SELECT * FROM Todo")
    fun getAllTodos(): List<Todo>
}



***TodoDAO DONE*****







*****T CODE DONE******** -->













</code>
    </pre>
</body>
</html>
 
